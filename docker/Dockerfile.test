# Flutter Testing Environment
FROM cirrusci/flutter:3.16.0

# Install additional testing dependencies
RUN apt-get update && apt-get install -y \
    curl \
    git \
    wget \
    unzip \
    xvfb \
    chromium-browser \
    && rm -rf /var/lib/apt/lists/*

# Set Chrome executable for Flutter tests
ENV CHROME_EXECUTABLE=/usr/bin/chromium-browser

# Create app directory
WORKDIR /app

# Copy pubspec files
COPY mobile/dot_attendance/pubspec.yaml /app/pubspec.yaml
COPY mobile/dot_attendance/pubspec.lock /app/pubspec.lock

# Install dependencies
RUN flutter pub get

# Copy test files and source
COPY mobile/dot_attendance/ /app/

# Generate code
RUN dart run build_runner build --delete-conflicting-outputs

# Create test results directory
RUN mkdir -p test-results

# Default command runs all tests
CMD ["flutter", "test", "--coverage"]