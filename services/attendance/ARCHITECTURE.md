# ğŸ—ï¸ Attendance Service Architecture

## ì‹œìŠ¤í…œ ê°œìš”

Attendance ì„œë¹„ìŠ¤ëŠ” ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë‹¤ì¤‘ í…Œë„ŒíŠ¸ ê·¼íƒœê´€ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ, ê³„ì¸µì  ê¶Œí•œ ê´€ë¦¬ì™€ ì‹¤ì‹œê°„ ë™ê¸°í™”ë¥¼ ì œê³µí•©ë‹ˆë‹¤. user-permission-diagram.md ì„¤ê³„ ëª…ì„¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ“ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Client Applications                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Web Dashboard     â”‚     Mobile App            â”‚
â”‚   (Next.js 15)     â”‚     (Flutter 3.x)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                     â”‚
           â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Supabase Edge Functions (Deno)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ auth-signup      â€¢ attendance-check           â”‚
â”‚  â€¢ attendance-report â€¢ permission-check          â”‚
â”‚  â€¢ shift-management  â€¢ notification-dispatch     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Permission & Business Logic Layer          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Role Hierarchy (Master/Admin/Manager/Worker)  â”‚
â”‚  â€¢ Row Level Security (RLS)                      â”‚
â”‚  â€¢ Multi-tenant Isolation                        â”‚
â”‚  â€¢ Audit Logging                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Layer (Supabase)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL 15 with 11 Core Tables               â”‚
â”‚  â€¢ organizations    â€¢ users       â€¢ employees    â”‚
â”‚  â€¢ attendance       â€¢ shifts      â€¢ locations    â”‚
â”‚  â€¢ permissions      â€¢ role_templates             â”‚
â”‚  â€¢ notifications    â€¢ audit_logs  â€¢ sync_queue   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

### Frontend - Web Dashboard
- **Framework**: Next.js 15.5
- **Language**: TypeScript 5.x
- **Styling**: Tailwind CSS 3.x
- **State Management**: Zustand
- **Data Fetching**: TanStack Query
- **Real-time**: Supabase Realtime
- **UI Components**: Radix UI + Shadcn/ui

### Frontend - Mobile App
- **Framework**: Flutter 3.x
- **Language**: Dart 3.x
- **State Management**: Riverpod 2.x
- **Theme**: Neo Brutal Design System
- **Local Storage**: Hive
- **HTTP Client**: Dio

### Backend
- **Runtime**: Node.js 18+
- **API Framework**: Next.js API Routes
- **Database**: PostgreSQL 15 (Supabase)
- **Authentication**: Supabase Auth (JWT)
- **Real-time**: Supabase Realtime (WebSocket)
- **File Storage**: Supabase Storage
- **Edge Functions**: Supabase Edge Functions (Deno)

## ğŸ“¦ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
attendance/
â”œâ”€â”€ web/                        # Next.js ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”œâ”€â”€ app/                   # App Router
â”‚   â”‚   â”œâ”€â”€ api/              # API Routes
â”‚   â”‚   â”œâ”€â”€ (auth)/           # ì¸ì¦ ê´€ë ¨ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ (dashboard)/      # ëŒ€ì‹œë³´ë“œ í˜ì´ì§€
â”‚   â”‚   â””â”€â”€ (admin)/          # ê´€ë¦¬ì í˜ì´ì§€
â”‚   â”‚
â”‚   â”œâ”€â”€ components/            # React ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ ui/              # ê¸°ë³¸ UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ features/        # ê¸°ëŠ¥ë³„ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ layouts/         # ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                   # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ supabase/        # Supabase í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ services/        # ì„œë¹„ìŠ¤ ë ˆì´ì–´
â”‚   â”‚   â”œâ”€â”€ hooks/           # Custom Hooks
â”‚   â”‚   â””â”€â”€ utils/           # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”‚   â”‚
â”‚   â””â”€â”€ styles/               # ê¸€ë¡œë²Œ ìŠ¤íƒ€ì¼
â”‚
â”œâ”€â”€ mobile/                    # Flutter ëª¨ë°”ì¼ ì•±
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ main.dart        # ì•± ì§„ì…ì 
â”‚   â”‚   â”œâ”€â”€ app/             # ì•± ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ features/        # ê¸°ëŠ¥ë³„ ëª¨ë“ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/        # ì¸ì¦
â”‚   â”‚   â”‚   â”œâ”€â”€ attendance/  # ê·¼íƒœ
â”‚   â”‚   â”‚   â””â”€â”€ profile/     # í”„ë¡œí•„
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ core/            # í•µì‹¬ ê¸°ëŠ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ api/         # API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ models/      # ë°ì´í„° ëª¨ë¸
â”‚   â”‚   â”‚   â””â”€â”€ services/    # ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ shared/          # ê³µìœ  ì»´í¬ë„ŒíŠ¸
â”‚   â”‚       â”œâ”€â”€ widgets/     # ì¬ì‚¬ìš© ìœ„ì ¯
â”‚   â”‚       â””â”€â”€ theme/       # í…Œë§ˆ ì„¤ì •
â”‚   â”‚
â”‚   â””â”€â”€ assets/               # ë¦¬ì†ŒìŠ¤ íŒŒì¼
â”‚
â””â”€â”€ supabase/                  # Supabase ì„¤ì •
    â”œâ”€â”€ migrations/           # DB ë§ˆì´ê·¸ë ˆì´ì…˜
    â”œâ”€â”€ functions/           # Edge Functions
    â””â”€â”€ seed.sql             # ì´ˆê¸° ë°ì´í„°
```

## ğŸ”„ ë°ì´í„° í”Œë¡œìš°

### ì¶œê·¼ í”„ë¡œì„¸ìŠ¤
```
1. ì§ì›ì´ ëª¨ë°”ì¼ ì•± ì‹¤í–‰
2. QR ì½”ë“œ ìŠ¤ìº”
3. ìœ„ì¹˜ ì •ë³´ ê²€ì¦
4. API ìš”ì²­ (JWT í† í° í¬í•¨)
5. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
   - QR ì½”ë“œ ìœ íš¨ì„± ê²€ì¦
   - ìœ„ì¹˜ ë²”ìœ„ í™•ì¸
   - ì¤‘ë³µ ì²´í¬ì¸ ë°©ì§€
6. ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë¡
7. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (WebSocket)
8. ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë°˜ì˜
```

### ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°
```
1. ê·¼íƒœ ê¸°ë¡ ìƒì„± (pending ìƒíƒœ)
2. ê´€ë¦¬ì ì•Œë¦¼ ë°œì†¡
3. ê´€ë¦¬ì ê²€í† 
4. ìŠ¹ì¸/ê±°ë¶€ ì²˜ë¦¬
5. ì§ì› ì•Œë¦¼
6. ê¸°ë¡ ìƒíƒœ ì—…ë°ì´íŠ¸
```

## ğŸ›¡ï¸ ë³´ì•ˆ ì•„í‚¤í…ì²˜

### ì¸ì¦ (Authentication)
- **JWT í† í°**: Supabase Auth ì œê³µ
- **ë¦¬í”„ë ˆì‹œ í† í°**: ìë™ ê°±ì‹ 
- **ì„¸ì…˜ ê´€ë¦¬**: ì„œë²„ ì‚¬ì´ë“œ ì„¸ì…˜
- **Multi-factor Authentication**: TOTP ê¸°ë°˜ 2FA ì§€ì›

### ì¸ê°€ (Authorization) - 4ë‹¨ê³„ ê³„ì¸µ êµ¬ì¡°
- **Row Level Security (RLS)**: ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ ë³´ì•ˆ
- **ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC)**:
  - `master_admin`: ì‹œìŠ¤í…œ ì „ì²´ ê´€ë¦¬, ì¡°ì§ ìƒì„±/ì‚­ì œ
  - `admin`: ì¡°ì§ ë‚´ ì „ì²´ ê´€ë¦¬, ì§ì› ê´€ë¦¬
  - `manager`: íŒ€ ê´€ë¦¬, ê·¼íƒœ ìŠ¹ì¸
  - `worker`: ê°œì¸ ê·¼íƒœ ê´€ë¦¬

### ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤
| ì—­í•  | ì¡°ì§ | ì‚¬ìš©ì | ì§ì› | ê·¼íƒœ | ì‹œí”„íŠ¸ | ë³´ê³ ì„œ |
|------|------|--------|------|------|--------|--------|
| Master Admin | CRUD | CRUD | CRUD | CRUD | CRUD | Full |
| Admin | R | CRU | CRUD | CRUD | CRUD | Full |
| Manager | R | R | RU | CRU/Approve | R/Assign | View |
| Worker | R | R(Self) | R(Self) | CR(Self) | R | - |

### ë°ì´í„° ë³´í˜¸
- **HTTPS**: ëª¨ë“  í†µì‹  ì•”í˜¸í™”
- **ì•”í˜¸í™”**: bcrypt ê¸°ë°˜ íŒ¨ìŠ¤ì›Œë“œ í•´ì‹±
- **ê°ì‚¬ ë¡œê·¸**: ëª¨ë“  ë³€ê²½ì‚¬í•­ audit_logs í…Œì´ë¸” ê¸°ë¡
- **Multi-tenant Isolation**: organization_id ê¸°ë°˜ ì™„ë²½í•œ ë°ì´í„° ë¶„ë¦¬

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### Frontend ìµœì í™”
- **ì½”ë“œ ë¶„í• **: Dynamic imports
- **ì´ë¯¸ì§€ ìµœì í™”**: Next.js Image
- **ìºì‹±**: React Query ìºì‹±
- **ë²ˆë“¤ ìµœì í™”**: Tree shaking

### Backend ìµœì í™”
- **ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ì‹±**: ì£¼ìš” ì¿¼ë¦¬ ìµœì í™”
- **ì»¤ë„¥ì…˜ í’€ë§**: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê´€ë¦¬
- **ìºì‹±**: Redis ìºì‹± (ì„ íƒì )
- **ë¹„ë™ê¸° ì²˜ë¦¬**: ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…

### ì‹¤ì‹œê°„ ì„±ëŠ¥
- **WebSocket ì—°ê²° ê´€ë¦¬**: ìë™ ì¬ì—°ê²°
- **ë©”ì‹œì§€ ë°°ì¹­**: ëŒ€ëŸ‰ ì—…ë°ì´íŠ¸ ìµœì í™”
- **ì„ íƒì  êµ¬ë…**: í•„ìš”í•œ ì±„ë„ë§Œ êµ¬ë…

## ğŸ”Œ í†µí•© í¬ì¸íŠ¸

### ë‚´ë¶€ ì„œë¹„ìŠ¤
- **Marketing Service**: ì§ì› ë°ì´í„° ì—°ë™
- **Scheduler Service**: ê·¼ë¬´ ì¼ì • ì—°ë™
- **Main Platform**: ì‚¬ìš©ì ì¸ì¦ ê³µìœ 

### ì™¸ë¶€ ì„œë¹„ìŠ¤
- **Push Notification**: FCM/APNS
- **SMS Gateway**: ì•Œë¦¼ ë°œì†¡
- **Email Service**: ë¦¬í¬íŠ¸ ë°œì†¡

## ğŸ“ˆ í™•ì¥ ê³„íš

### Phase 1 (í˜„ì¬)
- âœ… QR ê¸°ë°˜ ì¶œí‡´ê·¼
- âœ… ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ
- âœ… ê¸°ë³¸ ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°

### Phase 2 (Q2 2025)
- ìƒì²´ ì¸ì¦ (ì§€ë¬¸/ì–¼êµ´)
- GPS ìë™ ì²´í¬ì¸/ì•„ì›ƒ
- ê¸‰ì—¬ ì‹œìŠ¤í…œ ì—°ë™

### Phase 3 (Q3 2025)
- AI ê¸°ë°˜ ê·¼íƒœ íŒ¨í„´ ë¶„ì„
- ì˜ˆì¸¡ ìŠ¤ì¼€ì¤„ë§
- ë©€í‹° ë¸Œëœì¹˜ ì§€ì›

## ğŸš¨ ëª¨ë‹ˆí„°ë§

### ë©”íŠ¸ë¦­
- **API ì‘ë‹µ ì‹œê°„**: < 200ms
- **ì—ëŸ¬ìœ¨**: < 0.1%
- **ë™ì‹œ ì ‘ì†ì**: 1000+
- **ê°€ë™ë¥ **: 99.9%

### ë„êµ¬
- **ë¡œê¹…**: Winston + Supabase Logs
- **ì—ëŸ¬ íŠ¸ë˜í‚¹**: Sentry
- **APM**: New Relic (ì„ íƒì )
- **ìƒíƒœ ì²´í¬**: Health Check Endpoints

---
*ì´ ë¬¸ì„œëŠ” Context Managerì— ì˜í•´ ìë™ìœ¼ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.*