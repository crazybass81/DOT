#!/usr/bin/env node

const { createClient } = require('@supabase/supabase-js');\nrequire('dotenv').config({ path: './.env.local' });\n\n// Supabase ì„¤ì •\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://mljyiuzetchtjudbcfvd.supabase.co';\nconst supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nconsole.log('ğŸš€ DOT ê·¼íƒœê´€ë¦¬ ì‹œìŠ¤í…œ - í…ŒìŠ¤íŠ¸ ë°ì´í„° ì´ˆê¸°í™”');\nconsole.log('===============================================\\n');\n\nasync function setupTestData() {\n  try {\n    const supabase = createClient(supabaseUrl, supabaseKey, {\n      auth: { persistSession: false }\n    });\n\n    console.log('ğŸ“¡ Supabase ì—°ê²° ì„±ê³µ\\n');\n\n    // 1. í…ŒìŠ¤íŠ¸ ì¡°ì§ ìƒì„±\n    console.log('ğŸ¢ 1. í…ŒìŠ¤íŠ¸ ì¡°ì§ ìƒì„± ì¤‘...');\n    \n    const testOrganization = {\n      id: '550e8400-e29b-41d4-a716-446655440000',\n      name: 'DOT í…ŒìŠ¤íŠ¸ ì¹´í˜',\n      description: 'ê·¼íƒœê´€ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ìš© ì¡°ì§',\n      type: 'company',\n      address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',\n      phone: '02-1234-5678',\n      email: 'test@dotcafe.com',\n      settings: {\n        work_start_time: '09:00',\n        work_end_time: '18:00',\n        break_time: 60,\n        overtime_rate: 1.5\n      },\n      business_hours: {\n        monday: { open: '09:00', close: '18:00' },\n        tuesday: { open: '09:00', close: '18:00' },\n        wednesday: { open: '09:00', close: '18:00' },\n        thursday: { open: '09:00', close: '18:00' },\n        friday: { open: '09:00', close: '18:00' },\n        saturday: { open: '10:00', close: '16:00' },\n        sunday: { closed: true }\n      },\n      location: {\n        latitude: 37.5665,\n        longitude: 126.9780,\n        radius: 100\n      },\n      is_active: true\n    };\n\n    const { data: orgData, error: orgError } = await supabase\n      .from('organizations_v3')\n      .upsert(testOrganization)\n      .select()\n      .single();\n\n    if (orgError) {\n      console.log(`   âŒ ì¡°ì§ ìƒì„± ì‹¤íŒ¨: ${orgError.message}`);\n    } else {\n      console.log(`   âœ… ì¡°ì§ ìƒì„± ì„±ê³µ: ${orgData.name}`);\n    }\n\n    // 2. í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìë“¤ ìƒì„±\n    console.log('\\nğŸ‘¥ 2. í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„± ì¤‘...');\n    \n    const testUsers = [\n      {\n        id: '6ba7b810-9dad-11d1-80b4-00c04fd430c8',\n        email: 'master@dotcafe.com',\n        full_name: 'ê¹€ê´€ë¦¬ì',\n        phone: '010-1234-5678',\n        id_type: 'corporate',\n        is_active: true,\n        metadata: { \n          department: 'IT',\n          position: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì',\n          hire_date: '2024-01-01'\n        }\n      },\n      {\n        id: '6ba7b811-9dad-11d1-80b4-00c04fd430c8',\n        email: 'admin@dotcafe.com',\n        full_name: 'ë°•ë§¤ë‹ˆì €',\n        phone: '010-2345-6789',\n        id_type: 'corporate',\n        is_active: true,\n        metadata: { \n          department: 'ìš´ì˜',\n          position: 'ë§¤ì¥ ê´€ë¦¬ì',\n          hire_date: '2024-02-01'\n        }\n      },\n      {\n        id: '6ba7b812-9dad-11d1-80b4-00c04fd430c8',\n        email: 'employee1@dotcafe.com',\n        full_name: 'ì´ì§ì›',\n        phone: '010-3456-7890',\n        id_type: 'personal',\n        is_active: true,\n        metadata: { \n          department: 'ì„œë¹„ìŠ¤',\n          position: 'ë°”ë¦¬ìŠ¤íƒ€',\n          hire_date: '2024-03-01'\n        }\n      },\n      {\n        id: '6ba7b813-9dad-11d1-80b4-00c04fd430c8',\n        email: 'employee2@dotcafe.com',\n        full_name: 'ìµœì•Œë°”',\n        phone: '010-4567-8901',\n        id_type: 'personal',\n        is_active: true,\n        metadata: { \n          department: 'ì„œë¹„ìŠ¤',\n          position: 'ì„œë¹™ìŠ¤íƒœí”„',\n          hire_date: '2024-04-01'\n        }\n      }\n    ];\n\n    let userCount = 0;\n    for (const user of testUsers) {\n      const { data: userData, error: userError } = await supabase\n        .from('unified_identities')\n        .upsert(user)\n        .select()\n        .single();\n\n      if (userError) {\n        console.log(`   âŒ ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨ (${user.full_name}): ${userError.message}`);\n      } else {\n        console.log(`   âœ… ì‚¬ìš©ì ìƒì„± ì„±ê³µ: ${userData.full_name} (${userData.email})`);\n        userCount++;\n      }\n    }\n\n    // 3. ì—­í•  í• ë‹¹\n    console.log('\\nğŸ­ 3. ì—­í•  í• ë‹¹ ì¤‘...');\n    \n    const roleAssignments = [\n      {\n        id: '7ba7b810-9dad-11d1-80b4-00c04fd430c8',\n        identity_id: '6ba7b810-9dad-11d1-80b4-00c04fd430c8',\n        organization_id: '550e8400-e29b-41d4-a716-446655440000',\n        role: 'master',\n        assigned_by: null,\n        assigned_at: new Date().toISOString(),\n        is_active: true,\n        employee_code: 'M001',\n        department: 'IT',\n        position: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì'\n      },\n      {\n        id: '7ba7b811-9dad-11d1-80b4-00c04fd430c8',\n        identity_id: '6ba7b811-9dad-11d1-80b4-00c04fd430c8',\n        organization_id: '550e8400-e29b-41d4-a716-446655440000',\n        role: 'admin',\n        assigned_by: '6ba7b810-9dad-11d1-80b4-00c04fd430c8',\n        assigned_at: new Date().toISOString(),\n        is_active: true,\n        employee_code: 'A001',\n        department: 'ìš´ì˜',\n        position: 'ë§¤ì¥ ê´€ë¦¬ì'\n      },\n      {\n        id: '7ba7b812-9dad-11d1-80b4-00c04fd430c8',\n        identity_id: '6ba7b812-9dad-11d1-80b4-00c04fd430c8',\n        organization_id: '550e8400-e29b-41d4-a716-446655440000',\n        role: 'worker',\n        assigned_by: '6ba7b811-9dad-11d1-80b4-00c04fd430c8',\n        assigned_at: new Date().toISOString(),\n        is_active: true,\n        employee_code: 'W001',\n        department: 'ì„œë¹„ìŠ¤',\n        position: 'ë°”ë¦¬ìŠ¤íƒ€'\n      },\n      {\n        id: '7ba7b813-9dad-11d1-80b4-00c04fd430c8',\n        identity_id: '6ba7b813-9dad-11d1-80b4-00c04fd430c8',\n        organization_id: '550e8400-e29b-41d4-a716-446655440000',\n        role: 'worker',\n        assigned_by: '6ba7b811-9dad-11d1-80b4-00c04fd430c8',\n        assigned_at: new Date().toISOString(),\n        is_active: true,\n        employee_code: 'W002',\n        department: 'ì„œë¹„ìŠ¤',\n        position: 'ì„œë¹™ìŠ¤íƒœí”„'\n      }\n    ];\n\n    let roleCount = 0;\n    for (const assignment of roleAssignments) {\n      const { data: roleData, error: roleError } = await supabase\n        .from('role_assignments')\n        .upsert(assignment)\n        .select()\n        .single();\n\n      if (roleError) {\n        console.log(`   âŒ ì—­í•  í• ë‹¹ ì‹¤íŒ¨ (${assignment.employee_code}): ${roleError.message}`);\n      } else {\n        console.log(`   âœ… ì—­í•  í• ë‹¹ ì„±ê³µ: ${roleData.employee_code} - ${roleData.role}`);\n        roleCount++;\n      }\n    }\n\n    // 4. ìƒ˜í”Œ ì¶œê·¼ ê¸°ë¡ ìƒì„± (ìµœê·¼ 7ì¼)\n    console.log('\\nâ° 4. ìƒ˜í”Œ ì¶œê·¼ ê¸°ë¡ ìƒì„± ì¤‘...');\n    \n    const sampleAttendance = [];\n    const today = new Date();\n    \n    // ìµœê·¼ 7ì¼ê°„ì˜ ë°ì´í„° ìƒì„±\n    for (let i = 6; i >= 0; i--) {\n      const workDate = new Date(today);\n      workDate.setDate(today.getDate() - i);\n      const dateString = workDate.toISOString().split('T')[0];\n      \n      // ì£¼ë§ ì œì™¸\n      if (workDate.getDay() === 0 || workDate.getDay() === 6) {\n        continue;\n      }\n\n      // ê° ì§ì›ë³„ë¡œ ì¶œê·¼ ê¸°ë¡ ìƒì„±\n      const employees = [\n        '6ba7b812-9dad-11d1-80b4-00c04fd430c8', // ì´ì§ì›\n        '6ba7b813-9dad-11d1-80b4-00c04fd430c8'  // ìµœì•Œë°”\n      ];\n\n      for (const employeeId of employees) {\n        const baseTime = new Date(workDate);\n        baseTime.setHours(9, 0, 0, 0); // 9ì‹œ ì¶œê·¼ ê¸°ì¤€\n        \n        // ì¶œê·¼ ì‹œê°„ (Â±30ë¶„ ëœë¤)\n        const checkInTime = new Date(baseTime);\n        checkInTime.setMinutes(checkInTime.getMinutes() + (Math.random() - 0.5) * 60);\n        \n        // í‡´ê·¼ ì‹œê°„ (8ì‹œê°„ ê·¼ë¬´ + 1ì‹œê°„ íœ´ê²Œ + Î±)\n        const checkOutTime = new Date(checkInTime);\n        checkOutTime.setHours(checkOutTime.getHours() + 9);\n        checkOutTime.setMinutes(checkOutTime.getMinutes() + (Math.random() - 0.5) * 60);\n        \n        const record = {\n          employee_id: employeeId,\n          business_id: '550e8400-e29b-41d4-a716-446655440000',\n          check_in_time: checkInTime.toISOString(),\n          check_out_time: i < 2 ? null : checkOutTime.toISOString(), // ìµœê·¼ 2ì¼ì€ ë¯¸ì™„ë£Œ\n          work_date: dateString,\n          check_in_location: {\n            latitude: 37.5665 + (Math.random() - 0.5) * 0.001,\n            longitude: 126.9780 + (Math.random() - 0.5) * 0.001,\n            address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',\n            accuracy: 5\n          },\n          check_out_location: i < 2 ? null : {\n            latitude: 37.5665 + (Math.random() - 0.5) * 0.001,\n            longitude: 126.9780 + (Math.random() - 0.5) * 0.001,\n            address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',\n            accuracy: 5\n          },\n          verification_method: Math.random() > 0.5 ? 'gps' : 'qr',\n          status: i < 2 ? 'active' : 'completed',\n          break_time_minutes: 60,\n          overtime_minutes: Math.random() > 0.7 ? Math.floor(Math.random() * 120) : 0,\n          notes: i === 0 ? 'í…ŒìŠ¤íŠ¸ ì¶œê·¼ ê¸°ë¡' : null\n        };\n        \n        sampleAttendance.push(record);\n      }\n    }\n\n    let attendanceCount = 0;\n    for (const record of sampleAttendance) {\n      const { data: attData, error: attError } = await supabase\n        .from('attendance_records')\n        .upsert(record)\n        .select()\n        .single();\n\n      if (attError) {\n        console.log(`   âŒ ì¶œê·¼ ê¸°ë¡ ìƒì„± ì‹¤íŒ¨: ${attError.message}`);\n      } else {\n        console.log(`   âœ… ì¶œê·¼ ê¸°ë¡ ìƒì„±: ${record.work_date} - ${record.status}`);\n        attendanceCount++;\n      }\n    }\n\n    // 5. ìƒì„±ëœ ë°ì´í„° ê²€ì¦\n    console.log('\\nğŸ” 5. ìƒì„±ëœ ë°ì´í„° ê²€ì¦ ì¤‘...');\n    \n    const { data: activeEmployees, error: viewError } = await supabase\n      .from('active_employees')\n      .select('*');\n    \n    if (viewError) {\n      console.log(`   âŒ active_employees ë·° ì¡°íšŒ ì‹¤íŒ¨: ${viewError.message}`);\n    } else {\n      console.log(`   âœ… active_employees ë·°: ${activeEmployees?.length || 0}ëª…ì˜ í™œì„± ì§ì›`);\n      activeEmployees?.forEach(emp => {\n        console.log(`      - ${emp.full_name} (${emp.role}) - ${emp.organization_name}`);\n      });\n    }\n\n    // ìµœì¢… ê²°ê³¼ ìš”ì•½\n    console.log('\\nğŸ“Š === í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ ===');\n    console.log(`âœ… ì¡°ì§: 1ê°œ ìƒì„±`);\n    console.log(`âœ… ì‚¬ìš©ì: ${userCount}ëª… ìƒì„±`);\n    console.log(`âœ… ì—­í•  í• ë‹¹: ${roleCount}ê°œ ìƒì„±`);\n    console.log(`âœ… ì¶œê·¼ ê¸°ë¡: ${attendanceCount}ê°œ ìƒì„±`);\n    \n    console.log('\\nğŸ¯ í…ŒìŠ¤íŠ¸ ê³„ì • ì •ë³´:');\n    console.log('   â€¢ ë§ˆìŠ¤í„° ê´€ë¦¬ì: master@dotcafe.com (ê¹€ê´€ë¦¬ì)');\n    console.log('   â€¢ ì¼ë°˜ ê´€ë¦¬ì: admin@dotcafe.com (ë°•ë§¤ë‹ˆì €)');\n    console.log('   â€¢ ì§ì›1: employee1@dotcafe.com (ì´ì§ì›)');\n    console.log('   â€¢ ì§ì›2: employee2@dotcafe.com (ìµœì•Œë°”)');\n    \n    console.log('\\nğŸ’¡ ë‹¤ìŒ ë‹¨ê³„:');\n    console.log('1. API í…ŒìŠ¤íŠ¸: /api/attendance ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸');\n    console.log('2. í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸: ë¡œê·¸ì¸ ë° ì¶œê·¼/í‡´ê·¼ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸');\n    console.log('3. ì‹¤ì‹œê°„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸: WebSocket ì—°ê²° ë° ì—…ë°ì´íŠ¸');\n\n  } catch (error) {\n    console.error('âŒ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹¤íŒ¨:', error.message);\n    console.error('   ìƒì„¸ ì˜¤ë¥˜:', error);\n    process.exit(1);\n  }\n}\n\n// ì‹¤í–‰\nsetupTestData()\n  .then(() => {\n    console.log('\\nâœ¨ ëª¨ë“  í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('ğŸ’¥ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜:', error);\n    process.exit(1);\n  });