# DOT 출석 서비스 네이밍 통일 프로젝트 - 실행 계획서

## 📋 프로젝트 개요

**프로젝트명**: ID-ROLE-PAPER 아키텍처 기반 네이밍 통일  
**기간**: 2025-09-09 ~ 2025-10-31 (8주)  
**목표**: 혼재된 3개 역할 시스템을 단일 ID-ROLE-PAPER 아키텍처로 통합  

## 🎯 핵심 문제점 및 해결 목표

### 현재 문제점
- **3개의 병렬 역할 시스템**: UserRole(4계층) + UnifiedRole(5계층) + RoleType(7계층)
- **타입 불일치**: 12개 타입 파일에서 서로 다른 정의 사용
- **권한 시스템 혼재**: Legacy 4단계 vs 새로운 7단계 동적 계층
- **비즈니스 로직 분산**: 역할 계산이 DB함수와 TypeScript에 중복 구현

### 해결 목표
- ✅ **단일 진실 소스**: ID-ROLE-PAPER 통합 타입 시스템 구축
- ✅ **동적 역할 시스템**: Papers 기반 자동 역할 계산
- ✅ **완전한 호환성**: Legacy 시스템과 점진적 전환 보장
- ✅ **타입 안전성**: TypeScript 컴파일 에러 0개 달성

## 📊 현황 분석 결과

### 코드베이스 영향도 매트릭스

| 레이어 | 파일 수 | 영향도 | 주요 변경점 |
|--------|--------|--------|----------|
| **Types** | 12 | 🔴 Critical | 통합 타입 정의, 호환성 레이어 |
| **Services** | 16 | 🔴 Critical | Role 계산 로직, 권한 검증 |
| **Components** | 50+ | 🟡 High | Role 기반 UI 렌더링 |
| **API Routes** | 20+ | 🟡 High | Master-admin 권한 시스템 |
| **Database** | 5 | 🟡 Medium | Schema 업데이트, 마이그레이션 |
| **Tests** | 30+ | 🟢 Medium | 테스트 데이터 및 시나리오 |

### 리스크 평가

| 위험 요소 | 확률 | 영향도 | 완화 방안 |
|----------|------|--------|----------|
| 사용자 데이터 손실 | 낮음 | 치명적 | 완전한 백업 + 롤백 계획 |
| 권한 시스템 오작동 | 중간 | 높음 | 단계적 배포 + Fallback |
| Legacy API 호환성 깨짐 | 중간 | 중간 | 호환성 레이어 + 점진적 제거 |
| 개발 일정 지연 | 높음 | 중간 | 우선순위 기반 Phase 분할 |

## 🚀 5단계 마이그레이션 계획

### Phase 1: 타입 시스템 통합 (Week 1-2)
**목표**: 단일 진실 소스 구축 및 호환성 확보

#### 완료 항목 ✅
- [x] **통합 타입 정의**: `id-role-paper-unified.ts` 생성 완료
- [x] **마이그레이션 유틸리티**: `role-migration.ts` 구현 완료  
- [x] **테스트 슈트**: 포괄적 단위 테스트 작성 완료
- [x] **호환성 매핑**: Legacy → New role 변환 로직 구현

#### 진행 중 🔄
- [ ] **기존 타입 파일 정리**: Deprecation 마킹 및 호환성 유지
- [ ] **TypeScript 컴파일 검증**: 전체 프로젝트 빌드 성공
- [ ] **개발자 문서 업데이트**: 새로운 타입 시스템 가이드

### Phase 2: 서비스 레이어 마이그레이션 (Week 3-4)
**목표**: 핵심 비즈니스 로직을 새로운 시스템으로 전환

#### 주요 작업 항목
- [ ] **authService.ts**: 새로운 RoleType 및 권한 시스템 적용
- [ ] **roleManagementService.ts**: ID-ROLE-PAPER 계층 로직 구현
- [ ] **identityService.ts**: Personal/Corporate ID 관리 완성
- [ ] **paperService.ts**: 문서 기반 역할 계산 서비스 구현
- [ ] **permissionService.ts**: 새로운 권한 매트릭스 적용

#### 호환성 보장
- [ ] **LegacyCompatService**: 기존 API 호출 래핑
- [ ] **Feature Flag 시스템**: 점진적 기능 활성화
- [ ] **A/B 테스트 환경**: 새/구 시스템 병렬 검증

### Phase 3: 컴포넌트 레이어 마이그레이션 (Week 4-5)
**목표**: 사용자 인터페이스의 새로운 역할 시스템 반영

#### UI 컴포넌트 업데이트
- [ ] **RoleGuard 컴포넌트**: Papers 기반 권한 검증
- [ ] **Dashboard 컴포넌트**: 동적 역할 기반 메뉴/기능
- [ ] **Master-admin 컴포넌트**: 새로운 권한 시스템 적용
- [ ] **사용자 프로필**: ID-ROLE-PAPER 정보 표시

#### 사용자 경험 개선
- [ ] **역할 변경 플로우**: Papers 업로드/검증 UI
- [ ] **권한 안내**: 사용자별 가능한 작업 명시
- [ ] **에러 핸들링**: 권한 관련 친화적 에러 메시지

### Phase 4: API & 데이터베이스 마이그레이션 (Week 6-7)
**목표**: 데이터 저장소 및 API의 완전한 전환

#### 데이터베이스 마이그레이션
```sql
-- 새로운 테이블 스키마 (예시)
CREATE TABLE unified_identities (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  id_type id_type_enum NOT NULL,
  email VARCHAR UNIQUE NOT NULL,
  full_name VARCHAR NOT NULL,
  linked_personal_id UUID REFERENCES unified_identities(id),
  -- ... 추가 컬럼들
);

CREATE TABLE papers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  paper_type paper_type_enum NOT NULL,
  owner_identity_id UUID REFERENCES unified_identities(id),
  related_business_id UUID REFERENCES business_registrations(id),
  -- ... 추가 컬럼들
);
```

#### API 엔드포인트 재구성
- [ ] **새로운 REST API**: `/api/v2/identities`, `/api/v2/papers`
- [ ] **GraphQL 스키마**: 복합 쿼리 지원을 위한 GraphQL 도입 검토
- [ ] **Legacy API 호환**: 기존 엔드포인트 유지 (Deprecation 경고)

#### 데이터 마이그레이션 스크립트
- [ ] **사용자 데이터 변환**: 기존 users → unified_identities
- [ ] **역할 → Papers 변환**: Legacy roles → 해당 papers 생성
- [ ] **무결성 검증**: 마이그레이션 후 데이터 일관성 확인

### Phase 5: 최종 검증 및 배포 (Week 8)
**목표**: 프로덕션 배포 준비 및 완전한 시스템 전환

#### 성능 최적화
- [ ] **역할 계산 캐싱**: Redis 기반 역할 캐시 시스템
- [ ] **데이터베이스 인덱싱**: Papers 및 roles 테이블 최적화
- [ ] **API 응답 시간**: 권한 검증 < 50ms 목표

#### 최종 검증
- [ ] **End-to-End 테스트**: 전체 사용자 플로우 검증
- [ ] **성능 테스트**: 동시 사용자 1000명 부하 테스트
- [ ] **보안 감사**: 새로운 권한 시스템 보안 검증
- [ ] **사용자 승인 테스트**: 실제 사용자 그룹 파일럿 테스트

## 📈 성공 지표 (KPIs)

### 기술적 성능
| 지표 | 현재 | 목표 | 측정 방법 |
|------|------|------|----------|
| TypeScript 컴파일 에러 | 15+ | 0 | CI/CD 파이프라인 |
| 테스트 커버리지 | 65% | 95% | Jest 커버리지 리포트 |
| 권한 검증 응답시간 | 120ms | <50ms | APM 모니터링 |
| 빌드 시간 | 3.2분 | <2분 | CI 빌드 로그 |

### 비즈니스 영향
| 지표 | 현재 | 목표 | 측정 방법 |
|------|------|------|----------|
| 권한 오류율 | 2.1% | <0.1% | 에러 로그 분석 |
| 사용자 만족도 | N/A | 4.5/5 | 사용자 설문 |
| 새 역할 추가 시간 | 4시간 | 30분 | 개발 작업 추적 |
| 시스템 다운타임 | N/A | <10분 | 배포 중 모니터링 |

## 💡 핵심 혁신 사항

### 1. 동적 역할 시스템
- **기존**: 고정된 4단계 역할 (MASTER_ADMIN → WORKER)
- **신규**: Papers 기반 7단계 동적 계산 (SEEKER → FRANCHISOR)
- **장점**: 비즈니스 변화에 유연한 대응, 명확한 권한 근거

### 2. 문서 중심 권한 관리
- **기존**: 관리자가 수동으로 역할 할당
- **신규**: 문서(Papers) 업로드로 자동 역할 부여
- **장점**: 투명한 권한 체계, 감사 추적 가능

### 3. Personal/Corporate ID 분리
- **기존**: 단일 사용자 모델
- **신규**: 개인/기업 신원 명확 분리
- **장점**: 복합 비즈니스 구조 지원, 명확한 책임 소재

### 4. 비즈니스 컨텍스트 격리
- **기존**: 글로벌 권한 시스템
- **신규**: 사업장별 권한 스코프
- **장점**: 멀티 비즈니스 운영 지원, 권한 충돌 방지

## 🔄 지속적 개선 계획

### 단기 (1-3개월)
- [ ] **성능 모니터링**: 실시간 성능 지표 대시보드 구축
- [ ] **사용자 피드백**: 새로운 시스템에 대한 지속적 피드백 수집
- [ ] **버그 픽스**: 초기 운영 중 발견된 이슈 신속 대응

### 중기 (3-6개월)  
- [ ] **고급 기능**: 조건부 권한, 시간 기반 권한 등 구현
- [ ] **API 최적화**: GraphQL 전면 도입, 성능 최적화
- [ ] **모바일 앱 통합**: Flutter 앱의 새로운 권한 시스템 적용

### 장기 (6-12개월)
- [ ] **AI 기반 권한 추천**: 사용 패턴 기반 권한 최적화 제안
- [ ] **블록체인 검증**: Papers 위변조 방지를 위한 블록체인 도입 검토
- [ ] **멀티테넌트 아키텍처**: 완전한 SaaS 형태로의 확장

## 📞 커뮤니케이션 계획

### 이해관계자 보고
- **주간 진행 리포트**: 매주 금요일 프로젝트 현황 공유
- **마일스톤 리뷰**: 각 Phase 완료 시 상세 리뷰 미팅
- **위험 요소 알림**: 블로커 발생 시 즉시 에스컬레이션

### 개발팀 소통
- **데일리 스탠드업**: 매일 오전 10시 진행상황 및 블로커 공유
- **기술 리뷰**: 주요 기술 결정 시 팀 리뷰 진행
- **코드 리뷰**: 모든 마이그레이션 코드 2인 이상 리뷰 필수

### 사용자 소통
- **사전 공지**: 변경사항 1주 전 사용자 공지
- **교육 자료**: 새로운 시스템 사용법 가이드 제작
- **지원 채널**: 마이그레이션 기간 중 전담 지원팀 운영

## 📋 체크리스트 요약

### 즉시 시작 (이번 주)
- [x] ✅ Phase 1 핵심 컴포넌트 구현 완료
- [ ] 🔄 기존 타입 파일 deprecation 작업
- [ ] 🔄 전체 프로젝트 빌드 검증

### 2주 내 완료 목표
- [ ] 📅 Phase 1 완전 완료 (타입 시스템 통합)
- [ ] 📅 Phase 2 착수 (핵심 서비스 마이그레이션)
- [ ] 📅 테스트 환경 구축 및 CI/CD 파이프라인 업데이트

### 1개월 내 완료 목표  
- [ ] 📅 Phase 2-3 완료 (서비스 + 컴포넌트 레이어)
- [ ] 📅 데이터 마이그레이션 스크립트 완성
- [ ] 📅 베타 테스트 환경 구축

---

**프로젝트 리더**: 시스템 아키텍트  
**마지막 업데이트**: 2025-09-09  
**다음 검토일**: 2025-09-13 (금요일)

> **💡 핵심 메시지**: 이 마이그레이션은 단순한 네이밍 변경이 아닌, DOT 출석 서비스의 핵심 아키텍처를 더욱 유연하고 확장 가능한 형태로 진화시키는 전략적 투자입니다.